# 自定义视频播放组件

这是一个基于uniapp原生视频元素和自定义控制器实现的高级视频播放组件，提供了友好的用户界面和丰富的功能特性。该组件同时支持视频播放进度的上报与恢复，适用于在线教育、课程学习等场景。

## 功能特点

### 核心播放功能
- **播放/暂停控制**：支持视频播放与暂停
- **播放进度控制**：拖拽进度条调整视频播放位置
- **倍速播放**：支持0.5x、1x、1.5x等多种播放速度调整
- **全屏控制**：支持进入/退出全屏模式
- **自动隐藏控制器**：播放时控制器自动隐藏，提升观看体验

### 进阶功能
- **观看进度记录**：记录用户观看进度，支持断点续播
- **观看时长统计**：精确统计用户实际观看时长
- **进度上报**：定期向服务器上报观看进度
- **完播标记**：视频播放结束时自动标记完播状态

## 组件结构

整个视频组件由以下主要部分构成：

1. **主容器组件**（`index.vue`）：
   - 封装视频核心功能
   - 管理视频状态和事件处理
   - 连接视频元素与自定义控制器
2. **自定义控制器**（`components/Controller/index.vue`）：
   - 提供友好的用户界面控制元素
   - 处理用户交互事件
   - 展示播放状态和进度信息

## 实现思路

### 1. 视频核心功能实现

将原生视频元素的默认控制器隐藏，然后通过自定义控制器组件来实现更加灵活和美观的控制界面。

自定义控制器组件中将用户交互的动作通过自定义事件的形式抛给父组件index.vue，在index.vue中创建video上下文，调用video上下文上的api操作原生视频元素的行为，从而达到了控制效果

### 2. 事件处理与状态管理

视频组件通过监听原生视频元素的各种事件来同步状态和触发相应的功能：

- **loadedmetadata**：视频元数据加载完成后，获取视频时长，隐藏封面图
- **play/pause**：播放/暂停时更新状态，启动/停止计时器
- **timeupdate**：视频播放进度更新时，同步当前播放时间
- **ended**：视频结束时，标记结束状态，上报完播
- **fullscreenchange**：全屏状态变化时，更新界面

### 3. 控制器交互实现

控制器组件负责处理用户交互，并通过事件发送到父组件来控制视频：

- **播放/暂停**：点击按钮触发对应事件
- **进度控制**：拖拽进度条时计算目标时间，并在拖拽结束时触发seek事件
- **倍速控制**：选择不同倍速选项时触发速率变更事件
- **全屏控制**：点击全屏按钮时触发全屏状态变更事件

### 4. 进度上报与恢复

组件实现了用户观看进度的记录与恢复功能：

- **定时上报**：播放时每10秒上报一次观看进度

- **真实时长统计**：仅在视频实际播放时累计观看时长

- **断点续播**：页面加载时检查是否有历史记录，有则恢复到上次观看位置

  > 通过10s上报一次观看进度，服务端记录进度之后再次进入时获取到上次观看进度实现断点续播

### 5. 用户体验优化

- **控制器自动隐藏**：播放3秒后自动隐藏控制器，点击视频区域可重新显示
- **实时拖拽预览**：拖拽时在屏幕中央显示目标时间
- **进度条差异化显示**：区分"当前进度"和"已观看最大进度"
- **状态反馈**：不同状态下显示不同控制图标（播放/暂停/重播）

